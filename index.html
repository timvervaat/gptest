<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>FinanciÃ«le planningstool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- React (CDN, GitHub Pages proof) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">
  <div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   STAP 1 â€” FINANCIAL ENGINE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

function calculateAnnualCashflow(year, incomes, expenses, assumptions, householdType) {
  const grossIncome = incomes.reduce((sum, i) => {
    if (year < i.startYear) return sum;
    const growth = Math.pow(1 + (i.growthRate || 0) / 100, year - i.startYear);
    const base = i.frequency === 'monthly' ? i.amount * 12 : i.amount;
    return sum + base * growth;
  }, 0);

  const tax = calculateIncomeTaxNL(grossIncome, householdType);
  const toeslagen = calculateToeslagen({ yearlyIncome: grossIncome, childrenCount: assumptions.childrenCount, householdType });
  const netIncome = grossIncome - tax + toeslagen;

  const totalExpenses = expenses.reduce((sum, e) => {
    if (year < e.startYear) return sum;
    const inflation = e.adjustForInflation
      ? Math.pow(1 + assumptions.inflationRate / 100, year - e.startYear)
      : 1;
    const base = e.frequency === 'monthly' ? e.amount * 12 : e.amount;
    return sum + base * inflation;
  }, 0);

  return {
    income: netIncome,
    expenses: totalExpenses,
    savings: netIncome - totalExpenses
  };
}

function projectNetWorth({ startYear, endYear, startNetWorth, incomes, expenses, assumptions, householdType }) {
  let netWorth = startNetWorth;
  const timeline = [];

  for (let year = startYear; year <= endYear; year++) {
    const cashflow = calculateAnnualCashflow(year, incomes, expenses, assumptions, householdType);
    netWorth = netWorth * (1 + assumptions.investmentReturn / 100) + cashflow.savings;

    timeline.push({ year, cashflow, netWorth });
  }

  return timeline;
}

function findFireYear(timeline, target) {
  const hit = timeline.find(y => y.netWorth >= target);
  return hit ? hit.year : null;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   STAP 6â€“17 â€” NL BELASTINGEN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

function calculateIncomeTaxNL(income, householdType) {
  const taxable = householdType === 'fiscal-partner' ? income * 2 : income;
  let tax = taxable <= 73031
    ? taxable * 0.3693
    : 73031 * 0.3693 + (taxable - 73031) * 0.495;

  let generalCredit = 3070;
  if (taxable > 22660) {
    generalCredit = Math.max(0, 3070 - (taxable - 22660) * 0.06095);
  }

  let laborCredit = 5052;
  if (taxable > 37691) {
    laborCredit = Math.max(0, 5052 - (taxable - 37691) * 0.0651);
  }

  return Math.max(0, tax - generalCredit - laborCredit);
}

function calculateToeslagen({ yearlyIncome, childrenCount, householdType }) {
  if (!childrenCount) return 0;
  const income = householdType === 'fiscal-partner' ? yearlyIncome * 2 : yearlyIncome;
  const kinderbijslag = childrenCount * 1200;
  const threshold = householdType === 'fiscal-partner' ? 40000 : 30000;
  const kgb = income < threshold ? childrenCount * 2500 : 0;
  return kinderbijslag + kgb;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   STAP 18â€“20 â€” HYPOTHEEK
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

function calculateMortgageMonthlyPayment({ principal, interestRate, remainingMonths, mortgageType }) {
  const r = interestRate / 100 / 12;
  if (mortgageType === 'interest-only') return principal * r;
  return principal * (r * Math.pow(1 + r, remainingMonths)) / (Math.pow(1 + r, remainingMonths) - 1);
}

function mortgageToExpense(m) {
  return {
    id: m.id,
    name: m.name,
    amount: calculateMortgageMonthlyPayment(m),
    frequency: 'monthly',
    startYear: m.startYear,
    adjustForInflation: false
  };
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   STAP 21 â€” UI
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

function MortgageEditor({ mortgage, setMortgage }) {
  return (
    <div className="bg-white p-4 rounded shadow space-y-2">
      <h2 className="font-semibold">ğŸ  Hypotheek</h2>

      <input className="border p-1 w-full" type="number" value={mortgage.principal}
        onChange={e => setMortgage({ ...mortgage, principal: +e.target.value })} placeholder="Hoofdsom" />

      <input className="border p-1 w-full" type="number" step="0.1" value={mortgage.interestRate}
        onChange={e => setMortgage({ ...mortgage, interestRate: +e.target.value })} placeholder="Rente %" />

      <select className="border p-1 w-full" value={mortgage.mortgageType}
        onChange={e => setMortgage({ ...mortgage, mortgageType: e.target.value })}>
        <option value="annuity">AnnuÃ¯tair</option>
        <option value="interest-only">Aflossingsvrij</option>
      </select>
    </div>
  );
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   APP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

function App() {
  const startYear = new Date().getFullYear();

  const [income] = useState([
    { id: 1, amount: 80000, frequency: 'yearly', growthRate: 2, startYear }
  ]);

  const [mortgage, setMortgage] = useState({
    id: 1,
    name: 'Hypotheek',
    principal: 400000,
    interestRate: 4.2,
    mortgageType: 'annuity',
    remainingMonths: 360,
    startYear
  });

  const [expenses] = useState([
    { id: 1, name: 'Leven', amount: 2500, frequency: 'monthly', startYear, adjustForInflation: true }
  ]);

  const [childrenCount, setChildrenCount] = useState(0);
  const [householdType, setHouseholdType] = useState('single');
  const [netWorth] = useState(20000);

  const assumptions = { inflationRate: 2, investmentReturn: 7, childrenCount };

  const allExpenses = [...expenses, mortgageToExpense(mortgage)];

  const timeline = projectNetWorth({
    startYear,
    endYear: startYear + 40,
    startNetWorth: netWorth,
    incomes: income,
    expenses: allExpenses,
    assumptions,
    householdType
  });

  const fireTarget = allExpenses.reduce((s, e) => s + e.amount * 12, 0) / 0.04;
  const fireYear = findFireYear(timeline, fireTarget);

  return (
    <div className="max-w-3xl mx-auto p-6 space-y-4">
      <h1 className="text-2xl font-bold">FinanciÃ«le planningstool</h1>

      <MortgageEditor mortgage={mortgage} setMortgage={setMortgage} />

      <div className="bg-white p-4 rounded shadow space-y-2">
        <label>Kinderen</label>
        <input type="number" className="border p-1 w-full"
          value={childrenCount} onChange={e => setChildrenCount(+e.target.value)} />

        <label>Huishouden</label>
        <select className="border p-1 w-full"
          value={householdType} onChange={e => setHouseholdType(e.target.value)}>
          <option value="single">Single</option>
          <option value="fiscal-partner">Fiscaal partner</option>
        </select>
      </div>

      <div className="bg-green-50 p-4 rounded">
        <p>ğŸ’° Vermogen na 40 jaar: â‚¬{Math.round(timeline.at(-1).netWorth).toLocaleString()}</p>
        <p>ğŸ”¥ FIRE-jaar: {fireYear || 'niet bereikt'}</p>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
