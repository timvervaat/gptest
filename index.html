<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>FinanciÃ«le planningstool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- React 18 -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SCENARIO'S
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const SCENARIOS = {
  conservative: {
    label: 'Conservatief',
    assumptions: { inflationRate: 3, investmentReturn: 4, safeWithdrawalRate: 4 }
  },
  base: {
    label: 'Basis',
    assumptions: { inflationRate: 2, investmentReturn: 7, safeWithdrawalRate: 4 }
  },
  optimistic: {
    label: 'Optimistisch',
    assumptions: { inflationRate: 2, investmentReturn: 9, safeWithdrawalRate: 4 }
  }
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   NL BELASTING (vereenvoudigd)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function calculateIncomeTaxNL(yearlyIncome) {
  let tax;
  if (yearlyIncome <= 73031) {
    tax = yearlyIncome * 0.3693;
  } else {
    tax = 73031 * 0.3693 + (yearlyIncome - 73031) * 0.495;
  }

  let algemeneHeffingskorting = 3070;
  if (yearlyIncome > 22660) {
    algemeneHeffingskorting = Math.max(
      0,
      3070 - (yearlyIncome - 22660) * 0.06095
    );
  }

  let arbeidskorting = 5052;
  if (yearlyIncome > 37691) {
    arbeidskorting = Math.max(
      0,
      5052 - (yearlyIncome - 37691) * 0.0651
    );
  }

  return Math.max(0, tax - algemeneHeffingskorting - arbeidskorting);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TOESLAGEN (vereenvoudigd)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function calculateToeslagen({ yearlyIncome, childrenCount, householdType }) {
  if (childrenCount === 0) return 0;

  const inkomen = householdType === 'fiscal-partner'
    ? yearlyIncome * 2
    : yearlyIncome;

  const kinderbijslag = childrenCount * 1200;
  const drempel = householdType === 'fiscal-partner' ? 40000 : 30000;

  let kindgebondenBudget = 0;
  if (inkomen < drempel) {
    kindgebondenBudget = childrenCount * 2500;
  } else if (inkomen < drempel + 20000) {
    const factor = 1 - (inkomen - drempel) / 20000;
    kindgebondenBudget = childrenCount * 2500 * factor;
  }

  return kinderbijslag + Math.max(0, kindgebondenBudget);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   FINANCIAL ENGINE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function calculateAnnualCashflow(year, incomes, expenses, assumptions, meta) {
  const activeIncomes = incomes.filter(i => year >= i.startYear);
  const activeExpenses = expenses.filter(e => year >= e.startYear);

  const grossIncome = activeIncomes.reduce((sum, i) => {
    const growth = i.growthRate
      ? Math.pow(1 + i.growthRate / 100, year - i.startYear)
      : 1;
    const base = i.frequency === 'monthly' ? i.amount * 12 : i.amount;
    return sum + base * growth;
  }, 0);

  const tax = calculateIncomeTaxNL(grossIncome);
  const netIncome = grossIncome - tax;

  const toeslagen = calculateToeslagen({
    yearlyIncome: grossIncome,
    childrenCount: meta.childrenCount,
    householdType: meta.householdType
  });

  const expensesTotal = activeExpenses.reduce((sum, e) => {
    const inflation = e.adjustForInflation
      ? Math.pow(1 + assumptions.inflationRate / 100, year - e.startYear)
      : 1;
    const base = e.frequency === 'monthly' ? e.amount * 12 : e.amount;
    return sum + base * inflation;
  }, 0);

  return {
    income: netIncome,
    expenses: expensesTotal,
    savings: netIncome + toeslagen - expensesTotal
  };
}

function projectNetWorth({ startYear, endYear, startNetWorth, incomes, expenses, assumptions, meta }) {
  let netWorth = startNetWorth;
  const timeline = [];

  for (let year = startYear; year <= endYear; year++) {
    const cashflow = calculateAnnualCashflow(year, incomes, expenses, assumptions, meta);
    netWorth = netWorth * (1 + assumptions.investmentReturn / 100) + cashflow.savings;

    timeline.push({ year, netWorth, cashflow });
  }

  return timeline;
}

function findFireYear(timeline, target) {
  const hit = timeline.find(y => y.netWorth >= target);
  return hit ? hit.year : null;
}

function calculateFireTargetFromExpenses(expenses, swr) {
  const yearlyExpenses = expenses.reduce((sum, e) => {
    return sum + (e.frequency === 'monthly' ? e.amount * 12 : e.amount);
  }, 0);
  return yearlyExpenses / (swr / 100);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SVG CHART
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function NetWorthChart({ timeline, target }) {
  if (!timeline) return null;

  const width = 600;
  const height = 200;
  const padding = 30;
  const max = Math.max(target, ...timeline.map(y => y.netWorth));

  const points = timeline.map((y, i) => {
    const x = padding + i / (timeline.length - 1) * (width - padding * 2);
    const yPos = height - padding - (y.netWorth / max) * (height - padding * 2);
    return `${x},${yPos}`;
  }).join(' ');

  const targetY = height - padding - (target / max) * (height - padding * 2);

  return (
    <svg viewBox={`0 0 ${width} ${height}`} className="w-full bg-gray-50 rounded border">
      <line x1={padding} x2={width - padding} y1={targetY} y2={targetY} stroke="#22c55e" strokeDasharray="4" />
      <polyline fill="none" stroke="#3b82f6" strokeWidth="3" points={points} />
    </svg>
  );
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ITEM EDITOR (INKOMEN / UITGAVEN)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function ItemEditor({ item, onChange, onDelete, isIncome }) {
  return (
    <div className="border rounded p-3 bg-gray-50 space-y-2">
      <input
        className="border rounded px-2 py-1 w-full"
        placeholder="Naam"
        value={item.name}
        onChange={e => onChange({ ...item, name: e.target.value })}
      />

      <div className="flex gap-2">
        <input
          type="number"
          className="border rounded px-2 py-1 w-full"
          value={item.amount}
          onChange={e => onChange({ ...item, amount: +e.target.value })}
        />
        <select
          className="border rounded px-2 py-1"
          value={item.frequency}
          onChange={e => onChange({ ...item, frequency: e.target.value })}
        >
          <option value="monthly">per maand</option>
          <option value="yearly">per jaar</option>
        </select>
      </div>

      {isIncome && (
        <input
          type="number"
          className="border rounded px-2 py-1 w-full"
          placeholder="Groei %"
          value={item.growthRate || 0}
          onChange={e => onChange({ ...item, growthRate: +e.target.value })}
        />
      )}

      {!isIncome && (
        <label className="text-sm flex gap-2">
          <input
            type="checkbox"
            checked={item.adjustForInflation}
            onChange={e => onChange({ ...item, adjustForInflation: e.target.checked })}
          />
          Inflatie toepassen
        </label>
      )}

      <button onClick={onDelete} className="text-sm text-red-600 underline">
        Verwijderen
      </button>
    </div>
  );
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   APP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function App() {
  const [incomes, setIncomes] = useState([
    { id: 1, name: 'Salaris', amount: 80000, frequency: 'yearly', growthRate: 2, startYear: new Date().getFullYear() }
  ]);

  const [expenses, setExpenses] = useState([
    { id: 1, name: 'Levensonderhoud', amount: 2500, frequency: 'monthly', adjustForInflation: true, startYear: new Date().getFullYear() }
  ]);

  const [childrenCount, setChildrenCount] = useState(0);
  const [householdType, setHouseholdType] = useState('single');
  const [scenario, setScenario] = useState('base');
  const [netWorth, setNetWorth] = useState(20000);
  const [autoFire, setAutoFire] = useState(true);
  const [manualTarget, setManualTarget] = useState(1500000);

  const assumptions = SCENARIOS[scenario].assumptions;

  const fireTarget = autoFire
    ? calculateFireTargetFromExpenses(expenses, assumptions.safeWithdrawalRate)
    : manualTarget;

  const projections = projectNetWorth({
    startYear: new Date().getFullYear(),
    endYear: new Date().getFullYear() + 50,
    startNetWorth: netWorth,
    incomes,
    expenses,
    assumptions,
    meta: { childrenCount, householdType }
  });

  return (
    <div className="max-w-6xl mx-auto p-6 space-y-6">
      <h1 className="text-2xl font-bold">FinanciÃ«le planningstool</h1>

      <NetWorthChart timeline={projections} target={fireTarget} />

      <div className="grid md:grid-cols-2 gap-6">
        <div>
          <h2 className="font-semibold mb-2">ðŸ’° Inkomsten</h2>
          {incomes.map(i => (
            <ItemEditor
              key={i.id}
              item={i}
              isIncome
              onChange={u => setIncomes(incomes.map(x => x.id === i.id ? u : x))}
              onDelete={() => setIncomes(incomes.filter(x => x.id !== i.id))}
            />
          ))}
          <button
            className="text-sm underline mt-2"
            onClick={() => setIncomes([...incomes, {
              id: Date.now(),
              name: '',
              amount: 0,
              frequency: 'yearly',
              growthRate: 0,
              startYear: new Date().getFullYear()
            }])}
          >
            âž• Inkomen toevoegen
          </button>
        </div>

        <div>
          <h2 className="font-semibold mb-2">ðŸ›’ Uitgaven</h2>
          {expenses.map(e => (
            <ItemEditor
              key={e.id}
              item={e}
              isIncome={false}
              onChange={u => setExpenses(expenses.map(x => x.id === e.id ? u : x))}
              onDelete={() => setExpenses(expenses.filter(x => x.id !== e.id))}
            />
          ))}
          <button
            className="text-sm underline mt-2"
            onClick={() => setExpenses([...expenses, {
              id: Date.now(),
              name: '',
              amount: 0,
              frequency: 'monthly',
              adjustForInflation: true,
              startYear: new Date().getFullYear()
            }])}
          >
            âž• Uitgave toevoegen
          </button>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
